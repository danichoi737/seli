<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:macro name="seli_leg" params="leg">

    <xacro:if value="${leg == 'lf'}">
      <xacro:property name="body_to_hip_xyz" value="${body_to_hip_x} ${body_to_hip_y} 0"/>
      <xacro:property name="hip_visual_rpy" value="0 0 0"/>
      <xacro:property name="hip_to_upper_leg" value="${hip_to_upper_leg_x} -${hip_to_upper_leg_y} 0"/>
      <xacro:property name="upper_leg_mesh_path" value="package://seli_description/meshes/upper_leg_lf.stl"/>
      <xacro:property name="upper_leg_to_lower_leg_xyz" value="-${upper_leg_to_lower_leg_x} ${upper_leg_to_lower_leg_y} 0"/>
    </xacro:if>

    <xacro:if value="${leg == 'rf'}">
      <xacro:property name="body_to_hip_xyz" value="${body_to_hip_x} -${body_to_hip_y} 0"/>
      <xacro:property name="hip_visual_rpy" value="${pi} 0 0"/>
      <xacro:property name="hip_to_upper_leg" value="${hip_to_upper_leg_x} ${hip_to_upper_leg_y} 0"/>
      <xacro:property name="upper_leg_mesh_path" value="package://seli_description/meshes/upper_leg_rf.stl"/>
      <xacro:property name="upper_leg_to_lower_leg_xyz" value="-${upper_leg_to_lower_leg_x} -${upper_leg_to_lower_leg_y} 0"/>
    </xacro:if>

    <xacro:if value="${leg == 'lh'}">
      <xacro:property name="body_to_hip_xyz" value="-${body_to_hip_x} ${body_to_hip_y} 0"/>
      <xacro:property name="hip_visual_rpy" value="0 ${pi} 0"/>
      <xacro:property name="hip_to_upper_leg" value="-${hip_to_upper_leg_x} -${hip_to_upper_leg_y} 0"/>
      <xacro:property name="upper_leg_mesh_path" value="package://seli_description/meshes/upper_leg_lh.stl"/>
      <xacro:property name="upper_leg_to_lower_leg_xyz" value="-${upper_leg_to_lower_leg_x} ${upper_leg_to_lower_leg_y} 0"/>
    </xacro:if>

    <xacro:if value="${leg == 'rh'}">
      <xacro:property name="body_to_hip_xyz" value="-${body_to_hip_x} -${body_to_hip_y} 0"/>
      <xacro:property name="hip_visual_rpy" value="0 0 ${pi}"/>
      <xacro:property name="hip_to_upper_leg" value="-${hip_to_upper_leg_x} ${hip_to_upper_leg_y} 0"/>
      <xacro:property name="upper_leg_mesh_path" value="package://seli_description/meshes/upper_leg_rh.stl"/>
      <xacro:property name="upper_leg_to_lower_leg_xyz" value="-${upper_leg_to_lower_leg_x} -${upper_leg_to_lower_leg_y} 0"/>
    </xacro:if>

    <!-- Hip link -->
    <link name="${leg}_hip_link">
      <visual>
        <origin xyz="0 0 0" rpy="${hip_visual_rpy}"/>
        <geometry>
          <mesh filename="${hip_mesh_path}" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="white"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${hip_mesh_path}" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="${hip_mass}"/>
        <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                 iyy="0.0" iyz="0.0"
                 izz="0.0"/>
      </inertial>
    </link>

    <!-- Upper leg link -->
    <link name="${leg}_upper_leg_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${upper_leg_mesh_path}" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="black"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${upper_leg_mesh_path}" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0"/>
        <mass value="${upper_leg_mass}"/>
        <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                 iyy="0.0" iyz="0.0"
                 izz="0.0"/>
      </inertial>
    </link>

    <!-- Lower leg link -->
    <link name="${leg}_lower_leg_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${lower_leg_mesh_path}" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="black"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${lower_leg_mesh_path}" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0"/>
        <mass value="${lower_leg_mass}"/>
        <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                 iyy="0.0" iyz="0.0"
                 izz="0.0"/>
      </inertial>
    </link>

    <!-- Foot link -->
    <link name="${leg}_foot_link"/>

    <!-- Hip joint -->
    <joint name="${leg}_hip_joint" type="revolute">
      <origin xyz="${body_to_hip_xyz}" rpy="0 0 0"/>
      <parent link="body_link"/>
      <child link="${leg}_hip_link"/>
      <axis xyz="1 0 0"/>
      <limit lower="-${pi}" upper="${pi}" effort="0.0" velocity="0.0"/>
    </joint>

    <!-- Upper leg joint -->
    <joint name="${leg}_upper_leg_joint" type="revolute">
      <origin xyz="${hip_to_upper_leg}" rpy="0 0 0"/>
      <parent link="${leg}_hip_link"/>
      <child link="${leg}_upper_leg_link"/>
      <axis xyz="0 1 0"/>
      <limit lower="-${pi}" upper="${pi}" effort="0.0" velocity="0.0"/>
    </joint>

    <!-- Lower leg joint -->
    <joint name="${leg}_lower_leg_joint" type="revolute">
      <origin xyz="${upper_leg_to_lower_leg_xyz}" rpy="0 0 0"/>
      <parent link="${leg}_upper_leg_link"/>
      <child link="${leg}_lower_leg_link"/>
      <axis xyz="0 1 0"/>
      <limit lower="-${pi}" upper="${pi}" effort="0.0" velocity="0.0"/>
    </joint>

    <!-- Foot fixed joint -->
    <joint name="${leg}_foot_joint" type="fixed">
      <origin xyz="0 0 -${lower_leg_to_foot_distance}" rpy="0 0 0"/>
      <parent link="${leg}_lower_leg_link"/>
      <child link="${leg}_foot_link"/>
    </joint>
    
  </xacro:macro>
</robot>
